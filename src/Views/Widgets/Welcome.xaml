<UserControl x:Class="SourceGit.Views.Widgets.Welcome"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:SourceGit.Views.Controls"
             xmlns:widgets="clr-namespace:SourceGit.Views.Widgets"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="800">
    <Grid Background="Transparent" AllowDrop="True" Drop="OnPageDrop" MouseMove="OnPageMouseMove" MouseDown="OnPageMouseDown">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Vertical" Width="420" HorizontalAlignment="Center">
            <!-- Logo -->
            <Path
                    Margin="0,48,0,0"
                    Width="100" Height="100"
                    Data="{StaticResource Icon.Git}"
                    Fill="{DynamicResource Brush.Logo}"/>

            <!-- Welcome -->
            <TextBlock
                    Margin="0,16"
                    HorizontalAlignment="Center"
                    Text="{DynamicResource Text.Welcome.Title}"
                    FontSize="24pt"
                    FontWeight="ExtraBold"
                    TextOptions.TextFormattingMode="Ideal"
                    TextOptions.TextRenderingMode="ClearType"
                    Foreground="{DynamicResource Brush.FG2}"/>

        </StackPanel>

        <Grid Grid.Row="1" Margin="10,40" HorizontalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="32"/>
                <RowDefinition Height="60"/>
                <RowDefinition Height="32"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Grid.Row="0" Click="OnOpenClicked" Height="28" Width="240">
                <StackPanel Orientation="Horizontal">
                    <Path Width="16" Height="16" Data="{StaticResource Icon.Folder.Open}"/>
                    <TextBlock Margin="12,0,0,0" Text="{DynamicResource Text.Welcome.OpenOrInit}"/>
                </StackPanel>
            </Button>

            <Button Grid.Column="0"  Grid.Row="1" Click="OnCloneClicked" Height="28" Width="240">
                <StackPanel Orientation="Horizontal">
                    <Path Width="16" Height="16" Data="{StaticResource Icon.Pull}"/>
                    <TextBlock Margin="12,0,0,0" Text="{DynamicResource Text.Welcome.Clone}"/>
                </StackPanel>
            </Button>


            <!-- History -->
            <TextBlock
                Grid.Row="3"
                Grid.Column="0"
                Text="{DynamicResource Text.Welcome.Histories}"
                FontSize="13pt" FontWeight="ExtraBold"
                Foreground="{DynamicResource Brush.FG2}"/>
            <!-- History Tree -->
            <controls:Tree
                Grid.Row="4"
                Grid.Column="0"
                x:Name="treeHistory"
                Margin="0,4"
                TextElement.FontSize="14"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                ContextMenuOpening="OnTreeContextMenuOpening">
                <controls:Tree.ItemContainerStyle>
                    <Style TargetType="{x:Type controls:TreeItem}" BasedOn="{StaticResource Style.TreeItem}">
                        <EventSetter Event="MouseDoubleClick" Handler="OnTreeNodeDoubleClick"/>
                    </Style>
                </controls:Tree.ItemContainerStyle>

                <controls:Tree.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <Border Height="32">
                            <Grid IsHitTestVisible="False">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="22"/>
                                </Grid.ColumnDefinitions>

                                <controls:Bookmark
                                    Grid.Column="0"
                                    Margin="2,0,0,0"
                                    x:Name="BookmarkIcon"
                                    Width="16" Height="16"
                                    Color="{Binding Bookmark}"
                                    IsNewPage="False"/>

                                <StackPanel Grid.Column="1" x:Name="ContentsHistory" Orientation="Horizontal">
                                    <TextBlock Margin="8,0" Text="{Binding Name}"/>
                                    <TextBlock x:Name="Path" Text="{Binding Id}" Foreground="{DynamicResource Brush.FG2}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </HierarchicalDataTemplate>
                </controls:Tree.ItemTemplate>
            </controls:Tree>

            <!-- Bookmark -->
            <TextBlock
                Grid.Row="0"
                Grid.Column="2"
                Text="{DynamicResource Text.Welcome.Bookmarks}"
                FontSize="13pt" FontWeight="ExtraBold"
                HorizontalAlignment="Center"
                Foreground="{DynamicResource Brush.FG2}"/>

            <!-- Drop Area -->
            <Rectangle
                Grid.Row="1"
                Grid.RowSpan="4"
                Grid.Column="2"
                x:Name="dropArea"
                Margin="0,2"
                Stroke="{DynamicResource Brush.Border1}"
                StrokeThickness="2"
                StrokeDashArray="4,4"
                SnapsToDevicePixels="True"
                Visibility="Hidden"/>
            <controls:Tree
                Grid.Row="1"
                Grid.RowSpan="4"
                Grid.Column="2"
                x:Name="treeBookmarks"
                Margin="0,4"
                AllowDrop="True"
                TextElement.FontSize="14"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                ContextMenuOpening="OnTreeContextMenuOpening"
                DragEnter="OnTreeBookmarksDragEnter"
                DragLeave="OnTreeBookmarksDragLeave"
                DragOver="OnTreeBookmarksDragOver"
                Drop="OnTreeBookmarksDrop">
                <controls:Tree.ItemContainerStyle>
                    <Style TargetType="{x:Type controls:TreeItem}" BasedOn="{StaticResource Style.TreeItem}">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>

                        <EventSetter Event="Expanded" Handler="OnTreeNodeStatusChange"/>
                        <EventSetter Event="Collapsed" Handler="OnTreeNodeStatusChange"/>
                        <EventSetter Event="MouseDoubleClick" Handler="OnTreeNodeDoubleClick"/>
                    </Style>
                </controls:Tree.ItemContainerStyle>

                <controls:Tree.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <Border Height="32">
                            <Grid IsHitTestVisible="False">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="22"/>
                                </Grid.ColumnDefinitions>

                                <Path Grid.Column="0" Margin="2,0,0,0" x:Name="Icon" Width="16" Height="16" Data="{StaticResource Icon.Folder.Fill}"/>

                                <controls:Bookmark
                                    Grid.Column="0"
                                    Margin="2,0,0,0"
                                    x:Name="BookmarkIcon"
                                    Width="16" Height="16"
                                    Color="{Binding Bookmark}"
                                    IsNewPage="False"/>

                                <StackPanel Grid.Column="1" x:Name="ContentsBookmark" Orientation="Horizontal">
                                    <TextBlock Margin="8,0" Text="{Binding Name}"/>
                                    <TextBlock x:Name="Path" Text="{Binding Id}" Foreground="{DynamicResource Brush.FG2}"/>
                                </StackPanel>

                                <controls:TextEdit
                                    Grid.Column="1"
                                    x:Name="EditorBookmarks"
                                    Height="20"
                                    Margin="4,0,0,0"
                                    Text="{Binding Name}"
                                    FontSize="9pt"
                                    Loaded="RenameStart"
                                    KeyDown="RenameKeyDown"
                                    LostFocus="RenameEnd"
                                    IsHitTestVisible="True"
                                    Visibility="Collapsed"/>
                            </Grid>
                        </Border>

                        <HierarchicalDataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsGroup}" Value="True">
                                <Setter TargetName="Path" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="Icon" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="BookmarkIcon" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsGroup}" Value="False">
                                <Setter TargetName="Path" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="Icon" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="BookmarkIcon" Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type controls:TreeItem}}, Path=IsExpanded}" Value="True">
                                <Setter TargetName="Icon" Property="Data" Value="{StaticResource Icon.Folder.Open}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                <Setter TargetName="EditorBookmarks" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="ContentsBookmark" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </HierarchicalDataTemplate.Triggers>
                    </HierarchicalDataTemplate>
                </controls:Tree.ItemTemplate>
            </controls:Tree>
        </Grid>
        
        <!-- Popup -->
        <widgets:PopupPanel x:Name="popup" Grid.Row="0" Grid.RowSpan="2"/>
    </Grid>
</UserControl>
